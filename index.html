<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <title>Masses & Fuel</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <style>
    body {
      margin: 0;
      padding: 1rem;
      font-family: -apple-system, system-ui, sans-serif;
      background: #111;
      color: #eee;
    }

    h1 {
      font-size: 1.1rem;
      margin-bottom: 0.5rem;
    }

    label {
      font-size: 0.8rem;
      display: block;
      margin-bottom: 0.15rem;
    }

    input {
      width: 100%;
      padding: 0.35rem 0.4rem;
      border-radius: 4px;
      border: 1px solid #333;
      background: #000;
      color: #eee;
      font-size: 0.9rem;
      -webkit-appearance: none;
    }

    .row {
      margin-bottom: 0.6rem;
    }

    .row-small {
      display: flex;
      gap: 0.5rem;
      margin-bottom: 0.6rem;
    }

    .row-small .field {
      flex: 1;
    }

    button {
      padding: 0.4rem 0.6rem;
      border-radius: 4px;
      border: 1px solid #444;
      background: #222;
      color: #eee;
      font-size: 0.85rem;
    }

    button:active {
      background: #444;
    }

    .btn-main {
      width: 100%;
      margin-top: 0.4rem;
      background: #2b5cff;
      border-color: #2b5cff;
    }

    .btn-main:active {
      background: #2448c0;
    }

    .row-buttons {
      display: flex;
      gap: 0.5rem;
      margin-top: 0.4rem;
    }

    .value-box {
      padding: 0.4rem 0.5rem;
      border-radius: 4px;
      border: 1px solid #333;
      background: #000;
      font-size: 0.9rem;
      display: flex;
      justify-content: space-between;
    }

    .value-box span {
      min-width: 3.5rem;
      text-align: right;
      font-variant-numeric: tabular-nums;
    }

    /* Panneaux Limitation */
    .panel {
      position: fixed;
      left: 0;
      right: 0;
      bottom: 0;
      background: #181818;
      border-top: 1px solid #333;
      padding: 0.75rem;
      box-shadow: 0 -4px 12px rgba(0,0,0,0.6);
    }

    .panel-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.5rem;
    }

    .panel-header-title {
      font-size: 0.9rem;
      font-weight: 600;
    }

    .panel-body {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .panel-footer {
      margin-top: 0.6rem;
      display: flex;
      justify-content: flex-end;
      gap: 0.5rem;
    }

    .hidden {
      display: none;
    }

    @media (min-width: 768px) {
      body {
        max-width: 480px;
        margin: 0 auto;
      }
      .row-small {
        gap: 0.75rem;
      }
    }
  </style>
</head>

<body>
  <h1>Masses & Fuel</h1>

  <!-- Entrées principales -->
  <div class="row">
    <label for="zfw">ZFW (t)</label>
    <input id="zfw" type="number" step="0.1" inputmode="decimal">
  </div>

  <div class="row">
    <label for="rfl">RFL (t)</label>
    <input id="rfl" type="number" step="0.1" inputmode="decimal">
  </div>

  <div class="row-small">
    <div class="field">
      <label for="k">K</label>
      <input id="k" type="number" step="0.001" inputmode="decimal">
    </div>
    <div class="field">
      <label for="taxi">Taxi (t)</label>
      <input id="taxi" type="number" step="0.1" inputmode="decimal">
    </div>
  </div>

  <div class="row">
    <label for="block">Block Fuel (t)</label>
    <input id="block" type="number" step="0.1" inputmode="decimal">
  </div>

  <button id="btnCalc" class="btn-main">Calculer TOW / LAW</button>

  <div class="row-buttons">
    <button id="btnTowLimit">Lim TOW</button>
    <button id="btnLawLimit">Lim LAW</button>
  </div>

  <!-- Résultats -->
  <div class="row" style="margin-top:0.8rem;">
    <div class="value-box">
      <div>TOW (t)</div>
      <span id="towValue">0.0</span>
    </div>
  </div>

  <div class="row">
    <div class="value-box">
      <div>LAW (t)</div>
      <span id="lawValue">0.0</span>
    </div>
  </div>

  <!-- Panneau Limitation TOW -->
  <div id="towLimitPanel" class="panel hidden">
    <div class="panel-header">
      <div class="panel-header-title">Limitation TOW</div>
      <button id="btnTowLimitClose">✕</button>
    </div>

    <div class="panel-body">
      <div>
        <label for="towLimitInput">TOW limite (t)</label>
        <input id="towLimitInput" type="number" step="0.1" inputmode="decimal">
      </div>
      <!-- RFL reste géré sur l’écran principal -->
    </div>

    <div class="panel-footer">
      <button id="btnTowLimitApply">Appliquer</button>
    </div>
  </div>

  <!-- Panneau Limitation LAW -->
  <div id="lawLimitPanel" class="panel hidden">
    <div class="panel-header">
      <div class="panel-header-title">Limitation LAW</div>
      <button id="btnLawLimitClose">✕</button>
    </div>

    <div class="panel-body">
      <div>
        <label for="lawLimitInput">LAW limite (t)</label>
        <input id="lawLimitInput" type="number" step="0.1" inputmode="decimal">
      </div>
      <!-- RFL reste géré sur l’écran principal -->
    </div>

    <div class="panel-footer">
      <button id="btnLawLimitApply">Appliquer</button>
    </div>
  </div>

  <script>
    // Utilitaire: parse avec virgule ou point
    function parseNum(val) {
      if (typeof val !== 'string') return NaN;
      return parseFloat(val.replace(',', '.'));
    }

    const zfwInput   = document.getElementById('zfw');
    const rflInput   = document.getElementById('rfl');
    const kInput     = document.getElementById('k');
    const taxiInput  = document.getElementById('taxi');
    const blockInput = document.getElementById('block');

    const towValue = document.getElementById('towValue');
    const lawValue = document.getElementById('lawValue');

    const btnCalc = document.getElementById('btnCalc');

    // Calcul standard TOW / LAW
    btnCalc.addEventListener('click', () => {
      const zfw  = parseNum(zfwInput.value);
      const k    = parseNum(kInput.value);
      const taxi = parseNum(taxiInput.value);
      const block= parseNum(blockInput.value);

      if (isNaN(zfw) || isNaN(k) || isNaN(taxi) || isNaN(block) || k <= 0) {
        alert('Vérifier ZFW, K, Taxi et Block.');
        return;
      }

      // TOW = ZFW + Block - Taxi
      const tow = zfw + block - taxi;

      // LAW = TOW / K
      const law = tow / k;

      towValue.textContent = tow.toFixed(1);
      lawValue.textContent = law.toFixed(1);

      // Remise en forme
      zfwInput.value   = zfw.toFixed(1);
      blockInput.value = block.toFixed(1);
      taxiInput.value  = taxi.toFixed(1);
      kInput.value     = k.toFixed(3);
    });

    // ----- Panneau Limitation TOW -----
    const btnTowLimit      = document.getElementById('btnTowLimit');
    const towLimitPanel    = document.getElementById('towLimitPanel');
    const btnTowLimitClose = document.getElementById('btnTowLimitClose');
    const towLimitInput    = document.getElementById('towLimitInput');
    const btnTowLimitApply = document.getElementById('btnTowLimitApply');

    btnTowLimit.addEventListener('click', () => {
      towLimitInput.value = '';
      towLimitPanel.classList.remove('hidden');
      towLimitInput.focus();
    });

    btnTowLimitClose.addEventListener('click', () => {
      towLimitPanel.classList.add('hidden');
    });

    btnTowLimitApply.addEventListener('click', () => {
      const towLimit = parseNum(towLimitInput.value);
      const rfl      = parseNum(rflInput.value);
      const taxi     = parseNum(taxiInput.value);
      const k        = parseNum(kInput.value);

      if (isNaN(towLimit) || isNaN(rfl) || isNaN(taxi) || isNaN(k) || k <= 0) {
        alert('Vérifier TOW limite, RFL, Taxi et K.');
        return;
      }

      // 1) LAW_max = TOW_limit / K
      const lawMax = towLimit / k;

      // 2) ZFW_max = LAW_max - RFL
      let zfwMax = lawMax - rfl;
      if (zfwMax < 0) zfwMax = 0;

      // 3) Trip = TOW_limit - LAW_max
      const trip = towLimit - lawMax;

      // 4) Block_new = Taxi + Trip + RFL
      let blockNew = taxi + trip + rfl;
      if (blockNew < 0) blockNew = 0;

      // Mise à jour des champs
      zfwInput.value   = zfwMax.toFixed(1);
      blockInput.value = blockNew.toFixed(1);
      rflInput.value   = rfl.toFixed(1);
      kInput.value     = k.toFixed(3);

      // Recalcule TOW / LAW avec ces nouvelles valeurs
      const tow = zfwMax + blockNew - taxi;
      const law = tow / k;
      towValue.textContent = tow.toFixed(1);
      lawValue.textContent = law.toFixed(1);

      towLimitPanel.classList.add('hidden');
    });

    // ----- Panneau Limitation LAW -----
    const btnLawLimit      = document.getElementById('btnLawLimit');
    const lawLimitPanel    = document.getElementById('lawLimitPanel');
    const btnLawLimitClose = document.getElementById('btnLawLimitClose');
    const lawLimitInput    = document.getElementById('lawLimitInput');
    const btnLawLimitApply = document.getElementById('btnLawLimitApply');

    btnLawLimit.addEventListener('click', () => {
      lawLimitInput.value = '';
      lawLimitPanel.classList.remove('hidden');
      lawLimitInput.focus();
    });

    btnLawLimitClose.addEventListener('click', () => {
      lawLimitPanel.classList.add('hidden');
    });

    btnLawLimitApply.addEventListener('click', () => {
      const lawLimit = parseNum(lawLimitInput.value);
      const rfl      = parseNum(rflInput.value);
      const taxi     = parseNum(taxiInput.value);
      const k        = parseNum(kInput.value);

      if (isNaN(lawLimit) || isNaN(rfl) || isNaN(taxi) || isNaN(k) || k <= 0) {
        alert('Vérifier LAW limite, RFL, Taxi et K.');
        return;
      }

      // 1) TOW_max = LAW_limit * K
      const towMax = lawLimit * k;

      // 2) ZFW_max = LAW_limit - RFL
      let zfwMax = lawLimit - rfl;
      if (zfwMax < 0) zfwMax = 0;

      // 3) Trip = TOW_max - LAW_limit
      const trip = towMax - lawLimit;

      // 4) Block_new = Taxi + Trip + RFL
      let blockNew = taxi + trip + rfl;
      if (blockNew < 0) blockNew = 0;

      // Mise à jour des champs
      zfwInput.value   = zfwMax.toFixed(1);
      blockInput.value = blockNew.toFixed(1);
      rflInput.value   = rfl.toFixed(1);
      kInput.value     = k.toFixed(3);

      // Recalcule TOW / LAW avec ces nouvelles valeurs
      const tow = zfwMax + blockNew - taxi;
      const law = tow / k;
      towValue.textContent = tow.toFixed(1);
      lawValue.textContent = law.toFixed(1);

      lawLimitPanel.classList.add('hidden');
    });
  </script>
</body>
</html>
